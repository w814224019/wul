<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico">
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link href="/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/h-ui.admin/css/H-ui.admin.css" rel="stylesheet"
	type="text/css" />
<link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet"
	type="text/css" />

<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>刷新设置</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span>设置刷新计划<span class="c-gray en">&gt;</span>
 <a style="color: blue;" th:href="@{/article-list13(companyId=${st.id})}">返回运营线路</a>
 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
		物流公司或网点ID:
	 <input  type="text" class="input-text" style="width:100px" placeholder="输入id"    th:value=${st.id}   id="companyId" name=""> 
	 线路序号ID:
	 <input  type="text" class="input-text" style="width:100px" placeholder="输入id"    th:value=${st.xid}   id="xid" name=""> 
	 剩余物流币:
	 <input  type="text" class="input-text" style="width:100px" placeholder="输入id"    th:value=${st.money}   id="shengyu" name=""> 
	<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l">
	 
	设置次数：
	<input  type="text" class="input-text" style="width:150px" placeholder="刷新次数不能为空" id="total" name="">次数 
	
	</span><br/><br/>
	
	<form>
	
	
	日期范围：<span>08:00</span> 
	-
	<span>12:00</span> 
	间隔时间：
	<input  type="text" class="input-text" style="width:100px" placeholder="输入正整数" id="a1" name="">分钟 
	
	<br/>
	日期范围：<span>13:00</span> 
	-
	<span>18:00</span> 
	间隔时间：
	<input  type="text" class="input-text" style="width:100px" placeholder="输入正整数" id="a2" name="">分钟 
	
	<br/>
	日期范围：<span>19:00</span> 
	-
	<span>21:00</span> 
	间隔时间：
	<input  type="text" class="input-text" style="width:100px" placeholder="输入正整数" id="a3" name="">分钟 
	
	<br/>
	 
	 
	
	</form>
	 <a href="javascript:;" onclick="setFrequencyCron()" class="btn btn-primary radius"> 设置刷新计划</a>
	 <a href="javascript:;" onclick="chakanFrequencyCron()" class="btn btn-primary radius"> 查看该线路刷新计划</a>
	 </div>
	 <div id="fahjil"  style="display:none;">
	<a onclick="removetasks()" class="btn btn-danger radius">批量删除当前刷新计划</a>
	<label    class="r" >查看第
	<select style="width:60px"  id="pageNum" onChange="chakanFrequencyCron()" >
			<option value="0"   > 请选择</option>
		</select>
		页
	 <span class="r">共有： <span id="total1" ></span> 页,总共：<strong id="tiaoshu" ></strong>条</span>,
	 显示
   <select  id="pageSize" onChange="chakanFrequencyCron()">
<option value="10"  >10</option>
<option value="25" >25</option>
<option value="50" >50</option>
<option value="100" >100</option>
</select>
条,</label>
	</div>
	<div class="mt-20">
	<table class="table table-border table-bordered table-bg table-hover table-sort table-responsive">
			<thead>
				<tr class="text-c">
					<th width="25"><input type="checkbox" name="duoxuan" value=""></th>
					<th width="80">序号</th>
					<th width="80">公司或网点ID</th>
					<th >网点名称</th>
					<th width="80">出发地</th>
					<th width="80">到达地</th>
					<th width="80">状态</th>
					<th width="150">刷新时间</th>
				</tr>
			</thead>
			<tbody id="table-result">
			<div id="company"></div>
			<tr class="text-c"  >
					<td><input type="checkbox" name="duoxuan"></td>
					<td ></td>
					<td ></td>
					<td ></td>
					<td ></td>
					<td ></td>
					<td >等待</td>
					<td >2014-6-11 11:11:42</td>
				</tr>
				
			</tbody>
		</table>
	</div>
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script> 
<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript">
//删除当前所选
function removetasks(){
	var url="../removetasks";
	 var arr=[];//定义一个数组
	    var arr2=$("input[name='duoxuan']:checked");//获取多选框的数组
	    $.each(arr2,function () {
	        arr.push($(this).val());//把多选框数组的value放入自己定义的里面
	    })
	   // alert(arr)
	 var id=$.trim($("#companyId").val());
	console.log("参数data:"+id);
	$.ajax({
		"url":url,
	  "data":{
		  "ids" : arr.join(",")
		 
		},  
		"type":"post",
		"dataType":"json",
		"success":function(json){
			if(json.state==200){
				alert("批量删除成功！");
				location.href="";
			}else if(json.state==402){
				alert(json.message);
			}
		}
	});
}
//查看计划列表chakanFrequencyCron()
function chakanFrequencyCron(){
	document.getElementById("fahjil").style.display='block';
	 var url="../chakanFrequencyCron";
	 var companyId=$.trim($("#companyId").val());
	 var lineId=$.trim($("#xid").val());
	 var tbody=window.document.getElementById("table-result");
	 var pageNum=$.trim($("#pageNum").val());
	 var pageSize=$.trim($("#pageSize").val());
	 $.ajax({
			"url":url,
		  "data":{
			  "lineId":lineId,
			  "companyId":companyId,
			  "pageNum":pageNum,
			  "pageSize":pageSize,
			 
			},  
			"type":"post",
			"dataType":"json",
			"success":function(json){
				if(json.state==200){
					var str="";
					var data=json.data;
					$("#company").text(str);
					for(i in data){
							str+="<tr class='text-c'>"+
							"<td><input type='checkbox' value='"+data[i].time+'!'+data[i].linedId+"' name='duoxuan'></td>"+
							"<td align='center'>"+data[i].linedId+"</td>"+
							"<td align='center'>"+data[i].id+"</td>"+
							"<td align='center'>"+data[i].wname+"</td>"+
							"<td align='center'>"+data[i].sta+"</td>"+
							"<td align='center'>"+data[i].end+"</td>"+
							"<td align='center'>"+data[i].status+"</td>"+
							"<td align='center'>"+data[i].time+"</td>"+
							"</tr>";
					}
					//console.log(data[i].pages+"页数")
					var total=0;
					var tiaoshu=0;
					if (data.length==0){
						total=0;
						tiaoshu=0;
					}else{
						
					 total=data[i].pages;
					 tiaoshu=data[i].totals;
					}
					tbody.innerHTML=str;
					$("#total1").text(total);
					var option =""
						for(i=0;i<total;i++){
							//先创建好select里面的option元素
			                 option += "<option value='"+(i+1)+"' >"+(i+1)+"</option>";
						}
				    $('#pageNum').html(option);
				    $('#pageNum').val(pageNum);
					$("#tiaoshu").text(tiaoshu);
					
				}else if(json.state==402){
					alert(json.message);
				}
				
			}
		});
	 
}




function setFrequencyCron(){
	var url="../setFrequencyCron";
	 var id=$.trim($("#xid").val());
	 var companyId=$.trim($("#companyId").val());
	 var a1=$.trim($("#a1").val());
	 var a2=$.trim($("#a2").val());
	 var a3=$.trim($("#a3").val());
	 var total=$.trim($("#total").val());
	 var shengyu=$.trim($("#shengyu").val());
	/* //判断正整数
	 var re = /^[1-9]+[0-9]*]*$/;
		if (!re.test(a1)||!re.test(a2)||!re.test(a3)||!re.test(total)) {
			alert("请输入正整数");
			
		} */
	console.log("参数data:"+a1);
	$.ajax({
		"url":url,
	  "data":{
		  "id":id,
		  "companyId":companyId,
		  "a1":a1,
		  "a2":a2,
		  "a3":a3,
		  "total":total,
		  "shengyu":shengyu,
		},  
		"type":"post",
		"dataType":"json",
		"success":function(json){
			if(json.state==200){
				alert("设置刷新成功！");
				location.href="";
			}else if(json.state==402){
				alert(json.message);
			}
			
		}
	});
}






</script>


</body>

</html>